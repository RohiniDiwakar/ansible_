---
-  hosts: all
   become_user: root

   vars: 
     nfs_mountpoint: '/nfsmount'
     nfsserver: '192.168.122.111'
     fsexport: '/nfsshare'

   tasks:
   -  name: Install NFS 
      yum: 
        name=nfs-utils
        state=installed
        tags: nfs_server,nfs_client

   -  name: copy /etc/exports
      template:
        src=exports.j2
        dest=/etc/exports
        owner=root
        group=root
        mode=755
      tags: nfs_server,nfs_client

   -  name: start NFS service
      service:
        name=nfs
        state=restarted
        enabled=yes
      tags: nfs_server

   -  name: Create a mountpoint for NFS
      file:
        path={{ nfs_mountpoint }}
        state=directory
        mode=755
        owner=root
      tags: nfs_client

   -  name: update fstab and mount nfs share
      mount: 
        name={{ nfs_mountpoint }}
        src={{ nfsserver }}:/{{ nfsexport }}
        fstype=nfs
        opts=defaults,rw,bg
        dump=0                                                                  passsno=2                                                               state=mounted
      tags: nfs_client
